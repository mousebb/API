box: golang

services:
    - id: mariadb
      env:
        MYSQL_ROOT_PASSWORD: mypassword
        MYSQL_DATABASE: CurtData

    - id: mongo

    - id: elasticsearch:1.7

build:
  steps:
    - setup-go-workspace

    - script:
        name: sleeper
        code: |
            sleep 10

    - script:
        name: es-health
        code: |
            curl http://$ELASTICSEARCH_PORT_9300_TCP_ADDR:9200/_cluster/health?pretty=true

    # Gets the dependencies
    - script:
        name: go get
        code: |
            go get -v github.com/golang/lint/golint
            go get -v github.com/mattn/goveralls
            go get -d -t -v ./...

    # Build the project
    - script:
        name: go build
        code: |
            go build -v

    # Test the project
    - script:
        name: go test ./...
        code: |
            go test -v ./...
            go vet ./...
            golint ./...

    # Test coverage for the project
    - script:
        name: gocoveralls
        code: |
            $HOME/gopath/bin/goveralls -service=travis-ci
